\documentclass[]{article}
\usepackage{etex}
\usepackage[margin = 1.5in]{geometry}
\setlength{\parindent}{0in}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{color}
\usepackage{mathtools}
\usepackage{multicol}
\usepackage{pgfplots}
\usepackage{qtree}
\usepackage{xytree}
\usepackage[lined]{algorithm2e}
\usepackage{float}
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}
\usepackage[pdftex,
  pdfauthor={Michael Noukhovitch},
  pdftitle={CS 458: Computer Security and Privacy},
  pdfsubject={Lecture notes from CS 458 at the University of Waterloo},
  pdfproducer={LaTeX},
  pdfcreator={pdflatex}]{hyperref}

\usepackage{cleveref}
\usepackage{enumitem}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{
  language=C,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

\theoremstyle{definition}
\newtheorem*{defn}{Definition}
\newtheorem{ex}{Example}[section]
\newtheorem*{theorem}{Theorem}

\setlength{\marginparwidth}{1.5in}
\setlength{\algomargin}{0.75em}

\DeclarePairedDelimiter{\set}{\lbrace}{\rbrace}

\definecolor{darkish-blue}{RGB}{25,103,185}

\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=darkish-blue,
    filecolor=darkish-blue,
    linkcolor=darkish-blue,
    urlcolor=darkish-blue
}
\newcommand{\lecture}[1]{\marginpar{{\footnotesize $\leftarrow$ \underline{#1}}}}

\makeatletter
\def\blfootnote{\gdef\@thefnmark{}\@footnotetext}
\makeatother

\begin{document}
	\let\ref\Cref

	\title{\bf{CS 458: Computer Security and Privacy}}
	\date{Spring 2016, University of Waterloo \\ \center Notes written from Erinn Atawater's lectures.}
	\author{Michael Noukhovitch}

	\maketitle
	\newpage
	\tableofcontents
	\newpage

	\section{Introduction}
	\subsection{Security}
	Security can be defined as:
	\begin{description}
		\item[confidentiality] access to systems is limited to authorized
		\item[integrity] getting the correct data
		\item[availability] system is there when you want it
	\end{description}
	\subsection{Privacy}
	There are many definitions but we will stick to \textbf{informational self-determination}, where you control the information about you

	\subsection{Terminology}
	\begin{description}
		\item[assets] things we want to protect
		\item[vulnerabilities] weaknesses in a system that can be exploited
		\item[threats] loss or harm that may befall a system
			\begin{itemize}
				\item interception
				\item interruption
				\item modification
				\item fabrication
			\end{itemize}
		\item[threat model] set of threats to defend against (who/what)
		\item[attack] an action which exploits a vulnerability to execute a threat
		\item[control] removing or reducing a vulnerability
	\end{description}

	\subsection{Types of Defence}
	Defend against an attack:
	\begin{itemize}
		\item \textbf{prevent} stop the attack from happening
		\item \textbf{deter} make the attack more difficult
		\item \textbf{deflect} make it less attractive for attacker
		\item \textbf{recover} mitigate effects of the attack
	\end{itemize}

	Make sure that defence is correct with principles:
	\begin{itemize}
		\item \textbf{easiest penetration} system is only as strong as weakest link
		\item \textbf{adequate protection} don't spend more on defence than the value of the system
	\end{itemize}

	\subsection{Methods of Defence}
	\begin{itemize}
		\item Software controls: passwords, virus scanner \dots
		\item Hardware controls: fingerprint reader, smart token \dots
		\item Physical controls: locks, guards, backups \dots
		\item Policies: teaching employees, password changing rules
	\end{itemize}


	\section{Program Security}
	\subsection{Flaws, faults, and failures}
	\subsubsection{Defintions}
	\begin{description}
		\item[flaw] problem with a program
		\item[fault] a potential error inside the logic
		\item[failure] an actual error visible by the user
	\end{description}
	\subsubsection{Unexpected Behaviour}
	A spec will list the things a program will do but an implementation may have additional behaviour. 
	This can cause issues as these behaviours might not be tested and would be hard to test.

	\subsection{Unintentional Security Flaws}
	\subsubsection{Types of Flaws}
	\begin{itemize}
		\item \textbf{intentional}
			\begin{itemize}
				\item \textbf{malicious}: inserted to attack system
				\item \textbf{nonmalicious}: intentional features meant to be in the system but can cause issues
			\end{itemize}
		\item most flaws are \textbf{unintentional}
	\end{itemize}
	\subsubsection{Buffer Overflow}
	Most common exploited type of security flaw when program reads or writes past the bounds of the memory that it should use. If the attacker exploits it they can override things like the \textit{saved return address}. Targets programs on a local machine that run with setuid priveleges or network daemons
	
	\begin{ex}
		basic buffer overflow
	\begin{lstlisting}[language=C]
#define LINELEN 1024

char buffer[LINELEN];
strcpy(buffer, argv[1]);
	\end{lstlisting}
	\end{ex}
	
	\textbf{Types}:
	\begin{itemize}
		\item only a single byte can be written past the end of the buffer
		\item overflow of buffers on the heap (instead of the stack)
		\item jump to other parts of the program or libraries (instead of shellcode)
	\end{itemize}

	\textbf{Defences}:
	\begin{itemize}
		\item language with bounds-checking
		\item non-executable stack (mem is never both writable and executable)
		\item stack at random virtual addresses for each process
		\item ``canaries'' detect if stack has been overwritten before return
	\end{itemize}

	\subsubsection{Integer Overflows}
	Program may assume integer is always positive, and below certain value. Overflow will make a too large singed integer negative, violating assumptions.

	\subsubsection{Format String Vulnerabilities}
	Format strings can have unexpected consequences, \lstinline|printf|
	\begin{itemize}
		\item \texttt{buffer} parse buffer for \lstinline|\%|s and use whatever is on the stack to process found format params
		\item \texttt{\%s\%s\%s\%s} may crash your program
		\item \texttt{\%x\%x\%x\%x} dumps parts of the stack
		\item \texttt{\%n} will write to an address on the stack
	\end{itemize}

	\subsubsection{Incomplete Mediation}
	\begin{description}
		\item[mediation] ensure what the user has entered is a meaningful request
		\item[incomplete mediation] application accepts incorrect user data
	\end{description}
	Though \textbf{client-side} mediation is helpful to the user, you should always perform \textbf{server-side} mediation
	\begin{itemize}
		\item check values entered by user
		\item check state stored by client
	\end{itemize}
	\begin{description}
		\item[TOCTTOU] ``time of check to time of user'' errors are race conditions that may affect correct access to resources
	\end{description}
	Defend by making all access control information \textbf{constant} between TOC and TOU
	\begin{itemize}
		\item keep private copy of request
		\item act on object itself as opposed to symlinks \dots
		\item use locks on object
	\end{itemize}

	\subsection{Malware}
	\begin{itemize}
		\item written with malicious intent
		\item needs to executed to cause harm
	\end{itemize}

	\subsubsection{Virus}
	\begin{description}
		\item[virus] malware that infects other files (with copies of itself)
		\item[infect] modify existing program (\textit{host}) so opening gives control to virus
		\item[payload] end goal of virus (e.g. corrupt, erase \dots)
	\end{description}

	Protection can come in two forms:
	\begin{description}
		\item[signature-based] keep a list of all known viruses (but how to deal with polymorphic viruses?)
		\item[behaviour-based] look for suspicious system behaviour
	\end{description}

	\subsubsection{Worm}
	\begin{description}
		\item[worm] self-containing piece of code that replicated with little/no user input
	\end{description}
	\begin{itemize}
		\item often use security flaws in widely deployed software
		\item searches for other unprotected sources to spread to
	\end{itemize}

	\subsubsection{Other Types}
	\begin{description}
		\item[trojan horse] claim to do something normal, but hide malware
		\item[scareware] scaring user into agreeing
		\item[ransomware] ransoming user's resource
		\item[logic bomb] written by insider, already on your computer waiting to be triggered
	\end{description}

	\subsection{Other Malicious Code}
	\subsubsection{General Attacks}
	\begin{description}
		\item[web bug] tiny object in web page, fetched from a different server that can track you
		\item[backdoor] instructions set to bypass normal authentication, come from
	\end{description}
	\begin{itemize}
		\item forgetting to remove
		\item testing purposes
		\item law enforcement
		\item malicious purposes
	\end{itemize}
	\begin{description}
		\item[salami attack] attack from many smaller attacks
		\item[privelege escalation] raises privelege of attacker, can cause legitimate higher privelege code to execute attack
		\item[rootkit] tool to gain priveleged access and then hide itself
	\end{description}
	\begin{itemize}
		\item cleans logs
		\item modify basic commands \lstinline|ls|\dots
		\item modify kernel so no programs can see it
	\end{itemize}

	\subsubsection{Man-in-the-middle}
	intercepts communication but passes it on to intended party eventually
	\begin{description}
		\item[keystroke logger] logs keyboard input and spies on user
	\end{description}
	\begin{itemize}
		\item application-specific
		\item system logger (all keystrokes)
		\item hardware logger (physical device)
	\end{itemize}
	\begin{description}
		\item[interface illusions] tricks user to execute malicious action with UI
			\begin{description}
				\item[phishing] make fake website look real to extract user information
			\end{description}
	\end{description}

	\subsection{Nonmalicious flaws}
	\begin{description}
		\item[covert channels] transfer data through secret/non-standard channel (e.g. hide data in published report)
		\item[side channels] attack based on knowledge from physical behaviour of computer 
	\end{description}
	\begin{itemize}
		\item RF emissions
		\item power consumption
		\item cpu usage
		\item reflection of the screen
	\end{itemize}

	\subsection{Security Controls}
	\subsubsection{Design}
	Design programs so they're less likely to have flaws
	\begin{itemize}
		\item modularity
		\item encapsulation
		\item information hiding
		\item mutual suspicion
		\item confinement/sandboxing
	\end{itemize}

	\subsubsection{Implementation}
	When actually coding, reduce security flaws
	\begin{itemize}
		\item don't use C
		\item static code analysis
		\item formal methods
		\item genetic diversity (run varied code)
		\item educate yourself
	\end{itemize}

	\subsubsection{Change Management}
	Make sure that all changes to the code maintain security
	\begin{itemize}
		\item track changes in a system (CVS \dots)
		\item do post-mortems of security flaws
		\item code reviews
			\begin{itemize}
				\item guided code reviews
				\item easter-egg code reviews (intentional flaws)
			\end{itemize}
	\end{itemize}

	\subsubsection{Testing}
	Make sure implementation meets specification \textit{and nothing else}
	\begin{description}
		\item[black box testing] treat code as an opaque interface
		\item[fuzz testing] submit completely random data
		\item[white box testing] testing which understands how it works, good for regression testing
	\end{description}

	\subsubsection{Documentation}
	For posterity, write down:
	\begin{itemize}
		\item choices made
		\item things that didn't work
		\item security checklist
	\end{itemize}

	\subsubsection{Maintenance}
	Make sure that code out there gets better not worse
	\begin{description}
		\item[standards] rules to incorporate controls at each software stage
		\item[process] formal specs of how to implement each standard
		\item[audits] externally verify your processes are correct and followed
	\end{description}

	\section{Operating System Security}
	\subsection{Protection in a General-Purpose System}
	\subsubsection{Overview}
	Protect a user from attacks, and protect resources:
	\begin{itemize}
		\item CPU
		\item memory
		\item I/O devices
		\item programs
		\item data
		\item networks
		\item OS
	\end{itemize}

	\subsubsection{Separation/Sharing}
	Keep one users' objects separate from others'
	\begin{itemize}
		\item \textbf{physical} use different physical resource
		\item \textbf{temporal} execute at different times
		\item \textbf{logical} give impression that no other users exist
		\item \textbf{cryptographic} enrypt data to make it unintelligible
	\end{itemize}
	OS' can allow for \textbf{flexible sharing}, not ``all or nothing''
	\subsubsection{Memory Protection}
	Prevent one program from corrupting other programs, OS, data\dots
	\begin{description}
		\item[fence register] exception if memory access below address in fence register
		\item[base/bounds register pair] exception if memory not between register pair
		\item[tagged architechture] each memory word has extra bits that identify access to that word
	\end{description}
	
	\subsubsection{Segmentation}
	\textbf{segmentation} each program has different mem segments for code, data, stack.
	 Virtual address contains \lstinline|<segment name, offset within segment>| and segment name is mapped to physical address in \textit{Segment Table}
	\begin{itemize}
		\item[+] each address reference is checked for protection
		\item[+] different levels of protection
		\item[+] share/restrict access to a segment
		\item[-] external fragmentation
		\item[-] costly: dynamic length out-of-bounds checks, segment names
	\end{itemize}

	\subsubsection{Paging}
	\begin{description}
		\item[pages] equal divisions of virtual address space
		\item[frames] equal divisions of physical memory (size same as page)
		\item[page table] maps page number to corresponding frame \lstinline|<page #, offset within page>|, also contains memory protection bits for each page
	\end{description}
	\begin{itemize}
		\item[+] each address reference is checked for protection
		\item[+] share/restrict access to a page with different rights
		\item[+] unpopular pages can be moved to disk
		\item[-] internal fragmentation
		\item[-] infeasible to have different levels of protection for different data
	\end{itemize}

	\subsubsection{x86}
	Includes both segmentation and paging, with memory protection bits:
	\begin{itemize}
		\item no access
		\item read access
		\item read/write access
		\item *no execute
	\end{itemize}

	\subsection{Access Control}
	\subsubsection{Overview}
	We need to protect more than just memory, with three goals
	\begin{itemize}
		\item check every access
		\item enforce least privelege
		\item verify acceptable use
	\end{itemize}

	Create an \textbf{access control matrix} for a set of protected objects $0$, subjects $S$, and rights $R$ (r,w,x,o).

	\subsubsection{Access Control Methods}
	\begin{description}
		\item[Access Control Lists] each object has a list of subjects and their access rights
		\item[Capability] unforgeable token that gives own some access rights to an object
		\item[RBAC] admin assign users to roles and grants access rights to roles, can be h
	\end{description}
	\begin{itemize}
		\item can be hierarchical
		\item a user can have multiple roles for different tasks
		\item \textbf{separation of duty} same person can't be responsible for two different roles on a task
	\end{itemize}
	
	\subsection{User Authentication}
	\subsubsection{Overview}
	Computers systems have to identify and authenticate users before authorizing them
	\begin{description}
		\item[identify] who are you
		\item[authenticate] prove your identify
	\end{description}
	\subsubsection{Authentication Factors}
	Four classes, something the user:
	\begin{itemize}
		\item \textbf{knows} password, PIN
		\item \textbf{has} ATM card, physical key
		\item \textbf{is} biometrics
		\item \textbf{context} location, time
	\end{itemize}
	Using multiple factors (``two-factor'' authentication) improves security if they are different types

	\subsubsection{Passwords}
	Attacks:
	\begin{itemize}
		\item shoulder surfing
		\item keystroke logging
		\item phishing
		\item password re-use
		\item password guessing
	\end{itemize}

	User defenses:
	\begin{itemize}
		\item choosing good passwords (long and not easily guessable)
		\item hygiene
			\begin{itemize}
				\item write down > store insecurely
				\item change regularly
				\item site specific passwords
				\item don't reveal
				\item don't enter sensitive info on public computers
			\end{itemize}
	\end{itemize}

	Admin defenses:
	\begin{itemize}
		\item store only cryptographic hashes
			\begin{description}
				\item[salt] user-specific addition to hash (based on time of day \dots)
				\item[pepper] salt not stored alongside password
			\end{description}
		\item use expensive hash
			\begin{itemize}
				\item SHA-x take microseconds
				\item bcrypt takes hundreds of milliseconds
				\item scrypt also uses a lot of memory
			\end{itemize}
		\item use a \textbf{MAC} message authentication code
			\begin{itemize}
				\item also uses secret key to compute fingerprint
				\item impossible to crack without secret key
				\item as secure as hashing if key does leak
			\end{itemize}
		\item make password recovery force a reset
			\begin{itemize}
				\item don't email them the password, since you shouldn't be storing it
			\end{itemize}
		\item one-time passwords
			\begin{itemize}
				\item fight interception attacks 
				\item \textbf{challenge-response} to generate the password
			\end{itemize}
	\end{itemize}

	\subsubsection{Biometrics}
	Authenticate user if \textit{physical characteristic} is sufficiently similar to stored trait, but this has issues
	\begin{itemize}
		\item remote authentication can't test if you are trying to bypass it
		\item since we check for similarity, not equality, false positives are more likely
		\item facial recognition software still not good enough for security
		\item privacy issue if your stored biometrics leak
		\item if leaked, you can change a password, but not biometrics
		\item some of your biometrics are not secret (easy to get photos of\dots)
	\end{itemize}

	\subsection{Security Policies and Models}
	\subsubsection{Trusted OS}
	We trust an OS if we have confidence that it provides security services which build on four factors:
	\begin{description}
		\item[policy] set of rules outlining what is secured and why
		\item[model] implementes the policy and can be used for reasoning about it
		\item[design] spec of how OS implements model
		\item[trust] assurance that OS is implemented according to design
	\end{description}

	\subsubsection{Trusted Software}
	Software that does what we expect it to do and nothing more
	\begin{description}
		\item[functional correctness] software works correctly
		\item[enforcement of integrity] wrong inputs don't impact correctness
		\item[limited privelege] access rights are minimized
		\item[appropriate confidence level] rated as required 
	\end{description}

	\subsubsection{Security Policies}
	Basic military model:
	\begin{itemize}
		\item each object has a sensitivity level
		\item each object is assigned to one or more compartments
		\item subject can access if it \textit{dominates} the requirements
	\end{itemize}

	\begin{description}
		\item[Chinese Wall] security policy that once you access info you can't access info about competitors
		\item[ss-property] read access by subject to object if each object previously accessed is either from the same company, or a different type of company (no conflict)
		\item[*-property] write access by subject to object if all readable object by subject are either from the same company or have been \textit{sanitized} 
		\item[lattice] security model where there is a unique upper and lower bound for any two points, i.e. each level is distinct
	\end{description}

	\subsubsection{Security Models}
	\textbf{Bell-La Padula} regulates information flow in lattices, so users get information only with their clearance
	\begin{itemize}
		\item no read up (read more secure documents)
		\item no write down (write less secure documents)
	\end{itemize}
	\textbf{Biba} prevent inappropriate modification of data
	\begin{itemize}
		\item subjects and objects ordered by integrity
		\item no read down (don't contaminate reliable person with unreliable info)
		\item no write up (don't contaminate reliable info with unreliable person)
	\end{itemize}



\end{document}
